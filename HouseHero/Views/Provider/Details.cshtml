@model ProviderWithAllDataViewModel

@{
    ViewData["Title"] = "Details";
}

<h1>Details</h1>

<div>
    <h4>ProviderWithAllDataViewModel</h4>
    <hr />
    <dl class="row">
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.ProviderName)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.ProviderName)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.Email)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.Email)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.Age)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.Age)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.Bio)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.Bio)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.ProfilePicture_ID)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.ProfilePicture_ID)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.Address)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.Address)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.PhoneNumber)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.PhoneNumber)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.Password)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.Password)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.Rating)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.Rating)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.MinPrice)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.MinPrice)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.MaxPrice)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.MaxPrice)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.ServiceName)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.ServiceName)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.Save)
        </dt>
        <dd class="col-sm-10">
            @Html.CheckBoxFor(model => model.Save, new { @id = "saveCheckbox", @onchange = "saveProvider()" })
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.Days)
        </dt>
        <dd class="col-sm-10">
            <ul>
                @foreach (var day in Model.Days)
                {
                    <li>
                        <strong>Day:</strong> @day.Day <br />
                        <strong>Start Time:</strong> @day.Start_Time.ToString("hh:mm tt") <br />
                        <strong>End Time:</strong> @day.End_Time.ToString("hh:mm tt")
                        <p>Customer ID: @ViewBag.CustomerId</p>
                    </li>
                }
            </ul>
        </dd>
        <form asp-action="SaveReview" method="post">
            <input type="hidden" name="ProviderId" value="@Model.ProviderId" />
            <input type="hidden" name="CustomerId" value="@ViewBag.CustomerId" />

            <div class="form-group">
                <label for="Comment">Comment</label>
                <textarea class="form-control" id="Comment" name="Comment" rows="3"></textarea>
            </div>

            <div class="form-group">
                <label for="Rating">Rating (1-5)</label>
                <select class="form-control" id="Rating" name="Rating">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                </select>
            </div>

            <button type="submit" class="btn btn-primary">Submit</button>
        </form>
        <dt>
            <a asp-controller="Provider" asp-action="RequestService" asp-route-id="@Model.ProviderId"  class="text-decoration-none"> اطلب الخدمة الان</a>
        </dt>
    </dl>
</div>
<div>
    <a asp-controller="Category" asp-action="GetAll">Back to List</a>
</div>


<div class="modal fade" id="saveModal" tabindex="-1" role="dialog" aria-labelledby="saveModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="saveModalLabel">Notification</h5>
            </div>
            <div class="modal-body">
                
            </div>
        </div>
    </div>
</div>


<script>
    function saveProvider() {
        var isChecked = document.getElementById('saveCheckbox').checked;
        var providerId = '@Model.ProviderId';
        var customerId = '@ViewBag.CustomerId';
        var providerName = '@Model.ProviderName';

        $.ajax({
            url: '@Url.Action("SavedProvider", "Provider")',
            type: 'POST',
            data: {
                customerId: customerId,
                providerId: providerId,
                isSaved: isChecked
            },
            success: function (response) {
                var message = isChecked
                    ? providerName + " has been saved successfully!"
                    : providerName + " has been removed from the saved list!";
                $('.modal-body').text(message);
                $('#saveModal').modal('show');

                setTimeout(function () {
                    $('#saveModal').modal('hide');
                }, 1500); 
            },
            error: function (xhr, status, error) {
                console.error("An error occurred while saving the state.");
            }
        });
    }

    // Optionally trigger save before user leaves the page
    // window.onbeforeunload = function () {
    //     saveProvider();
    // };
</script>

@section ModalValid {
    <!-- Include Bootstrap and jQuery (necessary for the modal) -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
}


